{% extends 'base_framed.html' %}
{% load staticfiles %}

{% block content %}

  <!-- Page header -->
  <div class="page-heading animated fadeInDownBig">
    <h1>Użytkownicy
      <small>zarządzanie</small>
    </h1>
  </div>
  <!-- End page header -->

  <!-- Begin profile table -->
  <div class="box-info full">
    <h2><strong>Lista</strong> użytkowników</h2>

    <div class="table-responsive">
      <table class="table" data-sortable>
        <thead>
        <tr>
          <th>Nazwisko</th>
          <th>Rola</th>
          <th>Email</th>
          <th data-sortable="false">Opcje</th>
        </tr>
        </thead>

        <tbody>

        {% for profile in profile_list %}
          <tr>
            <td><strong>{{ profile.fullname | default:"N/A" }}</strong></td>
            <td>{% for role in profile.role_descs %} {{ role }} <br/> {% endfor %}</td>
            <td><a href="mailto:{{ profile.email }}">{{ profile.user.email }}</a></td>
            <td>

              <form method="post" action="{% url 'user:list' %}">
                {% csrf_token %}

                <input type="hidden" name="profile_id" value="{{ profile.id }}">
                <input type="hidden" name="pub.id" value="{{ pub.id }}">

                <div class="btn-group btn-group-xs" style="z-index: {{ forloop.revcounter }}">

                  <button type="button" data-toggle="modal" data-target="#confirmationModal"
                          data-profile-id="{{ profile.id }}" data-profile-fullname="{{ profile.fullname }}"
                          title="Usuń użytkownika z pubu" class="btn btn-default">
                    <i class="fa fa-power-off"></i>
                  </button>

                  {# Begin dropdown #}
                  <button id="dLabel" title="Nadaj użytkownikowi nową rolę" class="btn btn-default"
                          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-edit"></i>
                  </button>

                  <ul class="dropdown-menu" aria-labelledby="dLabel">
                    <li class="dropdown-header">Nowa rola dla użytkownika</li>
                    <li>
                      <button type="submit" name="action" value="admin" class="btn btn-link">Administrator</button>
                    </li>
                    <li>
                      <button type="submit" name="action" value="employee" class="btn btn-link">Pracownik baru</button>
                    </li>
                    <li>
                      <button type="submit" name="action" value="storeman" class="btn btn-link">
                        Pracownik magazynu
                      </button>
                    </li>
                  </ul>

                </div>
              </form>
              {# End dropdown #}

            </td>
          </tr>
        {% endfor %}

        </tbody>
      </table>
    </div>
  </div>
  <!-- End profile table -->

{% endblock content %}


{% block modals %}

  <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                  aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="confirmationModalLabel">Potwierdź usunięcie użytkownika</h4>
        </div>
        <form method="post" action="{% url 'user:list' %}">
          {% csrf_token %}
          <input type="hidden" name="profile_id" value="">
          <input type="hidden" name="pub_id" value="{{ pub.id }}">
          
          <div class="modal-body">
            <p>Czy na pewno chcesz usunąć użytkownika <span id="profileFullname"></span> z pubu {{ pub.name }}?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Pozostaw użytkownika</button>
            <button type="submit" name="action" value="remove" class="btn btn-primary">Usuń użytkownika</button>
          </div>
        </form>
      </div>
    </div>
  </div>

{% endblock modals %}

{% block js %}
  {{ block.super }}
  <script src="{% static 'assets/js/user_profile_list.js' %}"></script>
{% endblock js %}